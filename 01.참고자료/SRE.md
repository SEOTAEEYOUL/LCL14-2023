# SRE(Site Reliability Engineering)  
> [사이트 안정성 엔지니어링이란 무엇입니까?](https://www.ibm.com/topics/site-reliability-engineering)  

- `소프트웨어 공학(Software Engineering)`을 사용하여 일반적으로 `시스템 관리자가 수행하는 IT 운영 작업을 자동화`합니다.
  - [소프트웨어 공학(Software Engineering)](https://ko.wikipedia.org/wiki/%EC%86%8C%ED%94%84%ED%8A%B8%EC%9B%A8%EC%96%B4_%EA%B3%B5%ED%95%99) : 소프트웨어의 개발, 운용, 유지보수 등의 생명 주기 전반을 체계적이고 서술적이며 정량적으로 다루는 학문
- `"SRE는 소프트웨어 엔지니어에게 운영 팀 설계를 요청할 때 발생하는 것"`
- 개발자가 셀프 서비스로 운영을 하려면 그 플랫폼이 자동화되어 있어야 한다.
- 애플리케이션을  빌드하고 유연하게 배포하고, 이를 모니터링할 수 있는 플랫폼이 필요
- SRE의 역할은 이러한 플랫폼을 개발하고, 이 플랫폼 위에서 개발자들이 스스로 배포,운영을 하는 것이 목표

## "class SRE implements Devops"
### DevOps 가 개발과 운영의 사일로(분단) 현상을 해결하기 위한 방법론이자 하나의 조직문화에 대한 방향성이다. 
### SRE는 구글이 DevOps에 적용하기 위한 구체적인 프렉틱스(실사례)와 가이드  

## How SRE does Devops?
### 1. Reduce organizational silos
- 부서간 (개발과 운영)의 사일로(단절) 현상을 없애는 노력을 한다.

### 2. Accept failure as normal
- 장애에 대해서 민감하게 반응하지 않아야 하는데, 이를 위해서는 서로 비난 하지 않는 문화와 장애가 발생후에 이를 회고 하고 향후 대책을 수립하는 Postmortem  회고를 수행한다. 
- 또한 시스템의 가용성에 대한 적절한 관리를 위해서 Error budget 의 개념을 도입하여 사용한다. 

### 3. Implement gradual changes
- 변화 관리 특히 배포에 관련해서 큰 변경보다는 작은 변경이 배포하기도 편하고 장애가 났을때도 쉽게 롤백이 가능해서 MTTR을 줄일 수 있기 때문에, 점진적인 변경 방법을 쓴다. 카날리 배포나 롤링 업그레이드들이 이에 해당한다. 

### 4. Leverage tooling and automation
- 시스템 운영을 자동화 함으로써 사람이 운영에 관여하면서 발생할 수 있는 오류를 최소화하고, 수동(메뉴얼) 작업을 줄여서 사람은 좀 더 가치가 있는 일에 집중할 수 있도록 한다. 


### 5. Measure everything
- SRE는 의사결정을 데이타에 기반으로하기 때문에, 어떤 값들을 어떻게 메트릭으로 표현할것인지를 정하고, 시스템 지표뿐만 아니라, 수동 작업 시간, 장애 시간등 모든 것을 측정해서 데이타화 한다. 


## Metric matters
- SRE 프랙티스 에서는 의사 결정을 데이터에 따라 하기 때문에, 지표를 정의하는 것이 중요하다.   

### SLI (Service Level Indicator)
- 서비스에 대한 수준을 측정하여, 정량적으로 정의한 지표
- 한달동안 30분 장애  
  - 장애에 대한 SLI : 30 분
  - `가용성으로 정의 : (30일-30분)/(30일) * 100 = 99.9305 %` 로 표현하는 것이 좋음
#### SLI 로 많이 사용하는 지표
| 지표 | 설명 |  
|:---|:---|  
| 응답 시간 (Request latency) | 시스템의 응답시간 |  
| 에러율 (Error rate%) | 전체 요청에서 실패한 요청의 비율 |  
| 처리량(Throughput) | 일반적으로 초당 처리량으로 측정하고 TPS (Thoughput per second) 또는 QPS (Query per second)라는 단위를 사용한다. |  
| 가용성(availability) | 시스템의 업타임 비율로, 앞에서 예를 들어 설명하였다. |  
| 내구성(Durability-스토리지 시스템만 해당) | 스토리지 시스템에만 해당하는데, 장애에도 데이타가 유실되지 않을 확률이다. |  

#### 워크로드 타입에 따라 어떤 지표를 SLI로 사용해야 하는가?
| Workload Type | 지표 |  
|:---|:---|  
| `사용자에게 서비스를 제공하는 서비스 시스템 (웹,모바일등)` | `가용성`,` 응답시간`, `처리량` |  
| 스토리지 시스템(백업,저장 시스템) | 가용성, 응답시간, 내구성 |  
| 빅데이터 분석 시스템 | 처리량, 전체 End-to-End 처리 시간 |  
| 머신러닝 시스템 | 서빙 응답시간, 학습 시간, 처리량, 가용성, 서빙 정확도 |  

#### SLI 수집 및 표현
-  SRE에서는 퍼센트타일 기반의 SLI 분포도를 보고 90%,99%와 같이 `문제가 되는 구간의 지표`를 주요 SLI로 정해서 사용하는 것이 좋다.

#### SLI 지표의 표준화
| 표준화 대상 | 설명 |  
|:---|:---|  
| 수집 주기 | 지표를 뽑아내는 수집 주기를 10초 단위로 한다. |  
| 수집 범위 | 수집 범위는 서비스 클러스터 단위로 한다. |  
| 지표화 주기 | 수집은 10초 단위로 했지만, 지표화는 1분 단위로 해서 시각화 한다. |  
| 어떤 호출들을 포함 할것인가? | HTTP GET 응답 시간만을 측정하고, 내부 호출은 측정하지 않는다. |  
| 어떻게 데이터를 수집할것인가? | 모니터링 시스템을 통해서 수집한다. |  

### SLO (Service Level Objective)
- 각 지표에 대한 목표 값
- 예) "매주, 99% of REST API호출의 응답 시간은 100ms 이하여야한다." 

- **SLO = SLI + 목표값(Goal)**
- 서비스 제공자 관점이 아닌 `SLO`는 `사용자 관점`에서 서비스에 얼마나 영향을 주는 가의 관점에서 결정해야 한다. 

#### 좋은 SLO 란?
##### 단순할것
- 좋은 SLO를 복잡하지 않고 단순해서 이해하기 쉬워야한다.

##### 완벽한 값을 사용하지 말것
- 완벽한 시스템을 존재할 수 없고 현실성이 없다. 

##### 되도록이면 적은 수의 SLO 만 정의할 것 
- 적은 수의 SLO를 사용하되, 사용되는 SLO는 비지니스 의사결정의 기준으로 사용될 수 있는 SLO만 사용하도록 한다.
- 의사결정에 사용되지 않는 SLO는 쓸모가 없는 SLO이다. 
##### 지속적이고 점진적으로 SLO 값을 발전 시킬것
- SLO의 목표값은 낮은 값에서 시작해서 점차적으로 높은 값으로 바꿔 나가는 것이 바람직하다.
- 높은 값의 SLO를 목표값으로 시작했다가 개발/운영 조직이 이 목표를 맞추지 못했으니 SLO를 낮추자는 접근 방법은 그다지 좋지 못하다.
  - SLO를 맞추지 못했을때  SLO를 계속해서 낮춰가는 나쁜 습관을 만들 수 있다 

### SLO에 대한 기대치 관리
- SLO의 최소/최대 범위 지정
- 여유 값을 둘것
- Don’t overachieve


